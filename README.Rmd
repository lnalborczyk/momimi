---
output: github_document
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  cache = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "75%",
  dpi = 300,
  message = FALSE,
  warning = FALSE
  )
```

# Models of Motor Inhibition during Motor Imagery

[![Build Status](https://travis-ci.org/lnalborczyk/momimi.svg?branch=master)](https://travis-ci.org/lnalborczyk/momimi)
[![GitHub repo size](https://img.shields.io/github/repo-size/lnalborczyk/momimi?color=brightgreen&logo=github)](https://github.com/lnalborczyk/momimi)
[![GitHub last update](https://img.shields.io/github/last-commit/lnalborczyk/momimi?color=brightgreen&logo=github)](https://github.com/lnalborczyk/momimi)
[![GitHub downloads](https://img.shields.io/github/downloads/lnalborczyk/momimi/total?style=for-the-badge)](https://github.com/lnalborczyk/momimi)

The `momimi` package implements the "threshold modulation model" (TMM) and the "parallel inhibition model" (PIM) of motor inhibition during motor imagery and provides several fitting and plotting utilities.
    
## Installation

You can install the development version from GitHub with:

```{r installing, eval = FALSE}
# install.packages("devtools")
devtools::install_github(repo = "lnalborczyk/momimi", build_vignettes = TRUE)
```

## Usage

### Simulating and plotting data

We start by simulating some data (here, 100 observations or RTs and MTs).

```{r simulating1}
library(tidyverse)
library(momimi)

simulated_data <- model(
    nsims = 100, nsamples = 2000,
    exec_threshold = 1, imag_threshold = 0.5,
    amplitude_activ = 0.8, peak_time_activ = log(0.5), curvature_activ = 0.4,
    model_version = "TMM",
    full_output = TRUE
    )
```

We can plot the underlying activation function and the implied distributions of RTs and MTs.

```{r plotting}
# plotting only the latent function(s)
plot(x = simulated_data, method = "functions")

# plotting only the distributions of RTs/MTs distributions
plot(x = simulated_data, method = "distributions")
```

### Fitting the models

We can also use the model to generate realistic data from known parameter values and then fit the model to these data to try recovering the original parameter values.

```{r simulating2}
# plausible "true" parameter values
true_pars <- c(1.1, 0.5, 0.3, 1.25)

# simulating data using these parameter values
simulated_data <- model(
    nsims = 200, nsamples = 2000,
    exec_threshold = true_pars[4] * true_pars[1],
    imag_threshold = 0.5 * true_pars[4] * true_pars[1],
    amplitude_activ = true_pars[1],
    peak_time_activ = log(true_pars[2]),
    curvature_activ = true_pars[3],
    model_version = "TMM",
    full_output = FALSE
    ) %>%
    mutate(action_mode = "imagined") %>%
    # keeping only the relevant columns
    dplyr::select(
        sim,
        reaction_time = paste0("onset_", substr(unique(.$action_mode), 1, 4) ),
        movement_time = paste0("mt_", substr(unique(.$action_mode), 1, 4) ),
        action_mode
        ) %>%
    distinct() %>%
    dplyr::select(-sim)

# displaying the first ten rows of these data
head(x = simulated_data, n = 10)
```

```{r fitting}
# fitting the model
results <- fitting(
    data = simulated_data,
    nsims = 200,
    error_function = "g2",
    method = "DEoptim",
    model_version = "TMM",
    par_names = c("amplitude_activ", "peak_time_activ", "curvature_activ", "exec_threshold"),
    lower_bounds = c(0, 0.5, 0, 0),
    upper_bounds = c(2, 1.5, 1, 1),
    nstudies = 200,
    initial_pop_constraints = FALSE,
    maxit = 20
    )

# fitting summary
summary(results)
```

## References

Nalborczyk, L., Longcamp, M., Gajdos, T., Servant, M., & Alario, F.-X. (*to be submitted*). Towards formal models of inhibitory mechanisms involved in motor imagery: A commentary on Bach, Frank, & Kunde (2022).

## Getting help

If you encounter a bug or have a question please file an issue with a minimal reproducible example on [GitHub](https://github.com/lnalborczyk/momimi/issues).
